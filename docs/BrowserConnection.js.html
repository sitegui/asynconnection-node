<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: BrowserConnection.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: BrowserConnection.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

var EventEmitter = require('events').EventEmitter

/**
 * @class
 * @param {WebSocket} socket
 * @extends EventEmitter
 * @private
 */
function BrowserConnection(socket) {
	var that = this
	EventEmitter.call(this)

	/**
	 * @member {boolean}
	 * @readonly
	 */
	this.hasConnected = false

	/**
	 * @member {boolean}
	 * @readonly
	 */
	this.closed = false

	/**
	 * @member {WebSocket}
	 * @readonly
	 */
	this.socket = socket
	this.socket.binaryType = 'arraybuffer'

	// Set-up listeners
	this.socket.addEventListener('message', this._onmessage.bind(this))
	this.socket.addEventListener('close', this._onclose.bind(this))
	this.socket.addEventListener('error', this._onerror.bind(this))
	this.socket.addEventListener('open', function () {
		that.hasConnected = true
		/**
		 * @event Connection#connect
		 */
		that.emit('connect')
	})
}

require('util').inherits(BrowserConnection, EventEmitter)
module.exports = BrowserConnection

/**
 * Closes the connection
 */
BrowserConnection.prototype.close = function () {
	this.socket.close()
}

/**
 * @param {Buffer} frame
 * @private
 */
BrowserConnection.prototype.sendFrame = function (frame) {
	var len = frame.length
	if (this.closed) {
		return
	} else if (len >= 16777216) {
		// Hard limit of 16MiB
		throw new Error('Frame size exceeds maximum limit of 16MiB: ' + len)
	}

	this.socket.send(frame)
}

/**
 * @private
 */
BrowserConnection.prototype._onmessage = function (event) {
	var frame = new Buffer(new Uint8Array(event.data))

	/**
	 * @event Connection#frame
	 * @type {Buffer}
	 */
	this.emit('frame', frame)
}

/**
 * @private
 */
BrowserConnection.prototype._onclose = function () {
	if (!this.closed) {
		this.closed = true
		/**
		 * @event Connection#close
		 */
		this.emit('close')
		this.removeAllListeners('close').removeAllListeners('frame')
		this.socket = null
	}
}

/**
 * @param {Error} err
 * @private
 */
BrowserConnection.prototype._onerror = function (err) {
	/**
	 * @event Connection#error
	 * @type {Error}
	 */
	this.emit('error', err)
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Context.html">Context</a></li></ul><h3>Events</h3><ul><li><a href="Connection.html#event:close">close</a></li><li><a href="Connection.html#event:connect">connect</a></li><li><a href="Connection.html#event:error">error</a></li><li><a href="Connection.html#event:frame">frame</a></li><li><a href="Server.html#event:close">close</a></li><li><a href="Server.html#event:connection">connection</a></li><li><a href="Server.html#event:error">error</a></li><li><a href="WSConnection.html#event:close">close</a></li><li><a href="WSConnection.html#event:connect">connect</a></li><li><a href="WSConnection.html#event:error">error</a></li><li><a href="WSConnection.html#event:frame">frame</a></li><li><a href="WSServer.html#event:close">close</a></li><li><a href="WSServer.html#event:connection">connection</a></li><li><a href="WSServer.html#event:error">error</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Nov 27 2017 16:20:21 GMT-0200 (Horário brasileiro de verão)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
